<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equity Path Forecaster | Camac Consulting</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Camac Consulting Brand Colors */
        :root {
            --camac-dark: #001935;
            --camac-teal: #41797e;
            --camac-light: #f4f7f9;
            --camac-accent: #64748b;
            --white: #ffffff;
        }

        body { font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--white); padding: 15px; color: #333; margin: 0; }
        .container { max-width: 1000px; margin: auto; padding-bottom: 120px; } 
        
        .header-area { text-align: center; margin-bottom: 25px; border-bottom: 3px solid var(--camac-dark); padding-bottom: 20px; }
        .header-area h1 { font-size: 28px; color: var(--camac-dark); margin: 0; font-weight: 800; text-transform: uppercase; letter-spacing: -0.5px; }
        .header-area .brand-sub { font-size: 12px; color: var(--camac-teal); font-weight: bold; text-transform: uppercase; margin-top: 5px; letter-spacing: 3px; }

        .stats-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--camac-teal); color: white; padding: 18px; border-radius: 4px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-card.dark { background: var(--camac-dark); }
        .stat-card h2 { margin: 5px 0 0 0; font-size: 26px; font-weight: 300; }
        .stat-card p { margin: 0; font-size: 10px; text-transform: uppercase; font-weight: bold; opacity: 0.9; letter-spacing: 1px; }

        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; background: var(--camac-light); padding: 25px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        label { font-weight: bold; font-size: 10px; color: var(--camac-dark); text-transform: uppercase; display: block; margin-bottom: 6px; }
        input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; box-sizing: border-box; font-size: 14px; background: white; }
        input:focus { border-color: var(--camac-teal); outline: none; box-shadow: 0 0 0 2px rgba(65, 121, 126, 0.2); }
        
        .input-hint { font-size: 9px; font-style: italic; color: #64748b; line-height: 1.3; margin-top: 5px; display: block; }

        .btn-group { grid-column: 1 / -1; display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 12px; margin-top: 10px; }
        button { padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; letter-spacing: 1.5px; transition: 0.3s; font-size: 11px; }
        #runBtn { background: var(--camac-dark); color: white; }
        #exportBtn { background: var(--camac-teal); color: white; }
        #probBtn { background: var(--camac-accent); color: white; }
        button:hover { filter: brightness(1.2); transform: translateY(-1px); }
        button:disabled { background: #94a3b8; cursor: not-allowed; }

        .chart-container { height: 420px; margin-bottom: 30px; position: relative; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; }
        #loader { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; text-align: center; background: rgba(255,255,255,0.9); padding: 20px; border-radius: 8px; }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--camac-light); border-top: 4px solid var(--camac-teal); border-radius: 50%; animation: spin 1s linear infinite; margin: auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .table-wrapper { overflow-x: auto; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { background: var(--camac-dark); color: white; padding: 12px; text-align: left; text-transform: uppercase; letter-spacing: 1px; font-size: 10px; }
        td { border-bottom: 1px solid #eee; padding: 12px; }
        tr:nth-child(even) { background: #fcfcfc; }
        tr:hover { background: #f1f5f9; }
        
        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--camac-dark); padding: 15px 0; border-top: 4px solid var(--camac-teal); text-align: center; z-index: 1000; display: flex; justify-content: center; align-items: center; gap: 20px; }
        .footer-nav span { color: white; font-size: 10px; text-transform: uppercase; letter-spacing: 2px; opacity: 0.7; }
        .footer-nav a { color: #ffffff; background-color: var(--camac-teal); font-weight: bold; text-decoration: none; font-size: 12px; display: inline-block; padding: 10px 25px; border-radius: 4px; transition: 0.3s; }
        .footer-nav a:hover { background-color: var(--white); color: var(--camac-dark); }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <p class="brand-sub">Camac Consulting</p>
        <h1>Equity Path Forecaster</h1>
    </div>

    <div class="stats-bar">
        <div class="stat-card dark">
            <p id="tickerLabel">Market Price</p>
            <h2 id="livePrice">---</h2>
        </div>
        <div class="stat-card">
            <p id="probLabel">Prob. of Success</p>
            <h2 id="probDisplay">--%</h2>
        </div>
        <div class="stat-card">
            <p>Upper Confidence (90th)</p>
            <h2 id="targetDisplay">---</h2>
        </div>
    </div>

    <div class="controls">
        <div>
            <label>Asset Ticker</label>
            <input type="text" id="symbol" value="NVDA">
        </div>
        <div>
            <label>Manual Price Entry</label>
            <input type="number" id="manualPrice" placeholder="Override API..." step="0.01">
            <span class="input-hint">Use if real-time data is unavailable.</span>
        </div>
        <div>
            <label>Time Horizon (Days)</label>
            <input type="number" id="days" value="30">
        </div>
        <div>
            <label>Simulations</label>
            <input type="number" id="sims" value="1000">
        </div>
        <div>
            <label>Drift (Annual %)</label>
            <input type="number" id="drift" value="5.0" step="0.1">
            <span class="input-hint">Assumed annual growth bias.</span>
        </div>
        <div>
            <label>Price Target ($)</label>
            <input type="number" id="priceTarget" value="150">
        </div>
        
        <div class="btn-group">
            <button id="runBtn" onclick="analyzeAndRun()">Generate Forecast</button>
            <button id="exportBtn" onclick="downloadCSV()">Export Data</button>
            <button id="probBtn" onclick="calculateProbability()">Recalculate Goal</button>
        </div>
    </div>

    <div class="chart-container">
        <div id="loader">
            <div class="spinner"></div>
            <p style="font-size:10px; margin-top:10px; font-weight:bold; color: var(--camac-dark);">CALIBRATING VOLATILITY...</p>
        </div>
        <canvas id="mainChart"></canvas>
    </div>

    <div class="table-wrapper">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Interval</th>
                    <th>Bearish (10th P)</th>
                    <th>Median (50th P)</th>
                    <th>Bullish (90th P)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="footer-nav">
    <span>Proprietary Analysis Engine &copy; 2026</span>
    <a href="javascript:void(0);" onclick="window.open(window.location.href, '_blank');">EXPAND VIEW</a>
</div>

<script>
let chart;
let currentResults = { allPaths: [], p10: [], p50: [], p90: [], labels: [] };
const apiKey = '6PQ2Z7ZB4JQDZ3LS';

async function analyzeAndRun() {
    const symbol = document.getElementById('symbol').value.toUpperCase();
    const manualPrice = parseFloat(document.getElementById('manualPrice').value);
    const loader = document.getElementById('loader');
    const btn = document.getElementById('runBtn');

    loader.style.display = 'block';
    btn.disabled = true;

    if (!isNaN(manualPrice) && manualPrice > 0) {
        document.getElementById('livePrice').innerText = `$${manualPrice.toFixed(2)}`;
        document.getElementById('tickerLabel').innerText = `${symbol} (MANUAL)`;
        runMonteCarlo(manualPrice, 0.025);
        loader.style.display = 'none';
        btn.disabled = false;
        return;
    }

    try {
        const response = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${apiKey}`);
        const data = await response.json();
        
        if (data["Note"] || data["Information"]) {
            alert("API Rate Limit: Please enter price manually for Camac Analysis.");
            throw new Error("Limit");
        }

        const timeSeries = data["Time Series (Daily)"];
        if (!timeSeries) throw new Error("Invalid Ticker");

        const prices = Object.values(timeSeries).map(d => parseFloat(d["4. close"])).reverse();
        const currentPrice = prices[prices.length - 1];

        let returns = [];
        for (let i = 1; i < prices.length; i++) {
            returns.push(Math.log(prices[i] / prices[i-1]));
        }
        const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
        const variance = returns.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / (returns.length - 1);
        const dailyVol = Math.sqrt(variance);

        document.getElementById('livePrice').innerText = `$${currentPrice.toFixed(2)}`;
        document.getElementById('tickerLabel').innerText = `${symbol} CURRENT`;

        runMonteCarlo(currentPrice, dailyVol);
    } catch (e) {
        if (isNaN(manualPrice)) {
            runMonteCarlo(130.00, 0.022); 
            document.getElementById('livePrice').innerText = `$130.00`;
            document.getElementById('tickerLabel').innerText = `SAMPLE DATA`;
        }
    } finally {
        loader.style.display = 'none';
        btn.disabled = false;
    }
}

function runMonteCarlo(startPrice, vol) {
    const days = parseInt(document.getElementById('days').value);
    const sims = parseInt(document.getElementById('sims').value);
    const drift = (parseFloat(document.getElementById('drift').value) / 100) / 252; // Daily drift

    let results = Array.from({length: days + 1}, () => []);

    for (let s = 0; s < sims; s++) {
        let p = startPrice;
        results[0].push(p);
        for (let t = 1; t <= days; t++) {
            const shock = boxMuller();
            const val = (drift - 0.5 * Math.pow(vol, 2)) + (vol * shock);
            p *= Math.exp(val);
            results[t].push(p);
        }
    }
    updateUI(results, days, sims);
}

function boxMuller() {
    let u = 0, v = 0;
    while(u === 0) u = Math.random();
    while(v === 0) v = Math.random();
    return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
}

function updateUI(results, days, sims) {
    let labels = [], p10 = [], p50 = [], p90 = [], rows = "";
    const i10 = Math.floor(sims * 0.1), i50 = Math.floor(sims * 0.5), i90 = Math.floor(sims * 0.9);

    for (let t = 0; t <= days; t++) {
        results[t].sort((a,b) => a-b);
        labels.push(`Day ${t}`);
        p10.push(results[t][i10]); p50.push(results[t][i50]); p90.push(results[t][i90]);
        if (t % 5 === 0 || t === days) {
            rows += `<tr><td>Day ${t}</td><td>$${p10[t].toFixed(2)}</td><td>$${p50[t].toFixed(2)}</td><td>$${p90[t].toFixed(2)}</td></tr>`;
        }
    }

    currentResults = { allPaths: results[days], p10, p50, p90, labels, symbol: document.getElementById('symbol').value.toUpperCase() };
    document.getElementById('targetDisplay').innerText = `$${p90[days].toFixed(2)}`;
    document.querySelector("#dataTable tbody").innerHTML = rows;
    calculateProbability();

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('mainChart').getContext('2d'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'Median Projection', data: p50, borderColor: '#41797e', borderWidth: 3, fill: false, pointRadius: 0 },
                { label: 'Upper Band (90th)', data: p90, borderColor: '#001935', backgroundColor: 'rgba(0, 25, 53, 0.04)', fill: 2, pointRadius: 0 },
                { label: 'Lower Band (10th)', data: p10, borderColor: '#94a3b8', borderDash: [5,5], fill: false, pointRadius: 0 }
            ]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: false, 
            plugins: { 
                legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 11 } } }
            },
            scales: { 
                y: { ticks: { callback: v => '$' + v.toLocaleString(), font: { size: 10 } }, grid: { color: '#f0f0f0' } },
                x: { grid: { display: false }, ticks: { font: { size: 10 } } }
            }
        }
    });
}

function calculateProbability() {
    const target = parseFloat(document.getElementById('priceTarget').value);
    const finalPrices = currentResults.allPaths;
    if (!finalPrices || !finalPrices.length) return;
    const successes = finalPrices.filter(p => p >= target).length;
    const prob = ((successes / finalPrices.length) * 100).toFixed(1);
    document.getElementById('probDisplay').innerText = prob + "%";
    document.getElementById('probLabel').innerText = `Prob. of $${target}`;
}

function downloadCSV() {
    if (!currentResults.labels.length) return;
    let csvContent = "data:text/csv;charset=utf-8,Forecast Interval,Bearish,Median,Bullish\n";
    currentResults.labels.forEach((label, i) => {
        csvContent += `${label},${currentResults.p10[i].toFixed(4)},${currentResults.p50[i].toFixed(4)},${currentResults.p90[i].toFixed(4)}\n`;
    });
    const link = document.createElement("a");
    link.setAttribute("href", encodeURI(csvContent));
    link.setAttribute("download", `Camac_Forecast_${currentResults.symbol}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

window.onload = analyzeAndRun;
</script>
</body>
</html>
