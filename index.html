<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equity Path Forecaster | Camac Consulting</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --camac-dark: #001935;
            --camac-teal: #41797e;
            --camac-light: #f4f7f9;
            --white: #ffffff;
            --pessimistic-red: #991b1b;
            --optimistic-green: #166534;
        }

        body { font-family: "Segoe UI", Roboto, Arial, sans-serif; background: var(--white); color: #333; margin: 0; }
        
        /* Dashboard View */
        #dashboardView { max-width: 1100px; margin: auto; padding: 20px 20px 180px 20px; }
        
        .header-area { text-align: center; margin-bottom: 25px; border-bottom: 3px solid var(--camac-dark); padding-bottom: 20px; }
        .header-area h1 { font-size: 28px; color: var(--camac-dark); margin: 0; font-weight: 800; text-transform: uppercase; }
        .brand-sub { font-size: 12px; color: var(--camac-teal); font-weight: bold; text-transform: uppercase; letter-spacing: 3px; }

        .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 15px; }
        .stat-card { background: var(--camac-teal); color: white; padding: 18px; border-radius: 4px; text-align: center; }
        .stat-card.dark { background: var(--camac-dark); }
        .stat-card h2 { margin: 5px 0 0 0; font-size: 24px; font-weight: 300; }
        .stat-card p { margin: 0; font-size: 10px; text-transform: uppercase; font-weight: bold; }

        /* Full Page Simulation View (The "New Page") */
        #fullScaleView { display: none; background: #fff; min-height: 100vh; padding: 40px; box-sizing: border-box; }
        .full-view-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--camac-dark); padding-bottom: 15px; margin-bottom: 30px; }
        
        /* Inputs & Controls */
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; background: var(--camac-light); padding: 30px; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 30px; }
        label { font-weight: bold; font-size: 10px; color: var(--camac-dark); text-transform: uppercase; display: block; margin-bottom: 6px; }
        input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 14px; background: white; box-sizing: border-box; }
        .input-note { font-size: 9px; font-style: italic; color: #64748b; margin-top: 4px; line-height: 1.3; }

        .preset-group { display: flex; gap: 5px; margin-top: 5px; }
        .btn-preset { padding: 8px 4px; flex: 1; border: 1px solid #cbd5e1; border-radius: 3px; cursor: pointer; font-size: 9px; font-weight: bold; }
        .btn-preset.active { border: 2px solid var(--camac-dark); background: #e2e8f0; }

        .btn-group { grid-column: 1 / -1; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 12px; margin-top: 15px; }
        .main-btn { padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 11px; }

        /* Graphics */
        .chart-container { height: 550px; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 25px; position: relative; }

        /* Enter/Exit View Buttons */
        .view-toggle-bar { background: var(--camac-dark); text-align: center; padding: 20px; border-radius: 8px; cursor: pointer; margin-top: 30px; transition: 0.3s; }
        .view-toggle-bar:hover { background: var(--camac-teal); }
        .view-toggle-bar span { color: white; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; font-size: 13px; }

        .exit-btn { background: #eee; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 800; font-size: 11px; text-transform: uppercase; }

        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--camac-dark); padding: 20px 0; border-top: 4px solid var(--camac-teal); text-align: center; z-index: 100; }
        .footer-brand { color: white; font-size: 11px; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

<div id="dashboardView">
    <div class="header-area">
        <p class="brand-sub">Camac Consulting</p>
        <h1>Executive Dashboard</h1>
    </div>

    <div class="stats-bar">
        <div class="stat-card dark"><p>Entry Price</p><h2 id="dashPrice">$0.00</h2></div>
        <div class="stat-card"><p>Target Probability</p><h2 id="dashProb">-%</h2></div>
        <div class="stat-card"><p>Median Forecast</p><h2 id="dashMedian">$0.00</h2></div>
        <div class="stat-card"><p>90th Percentile</p><h2 id="dashUpper">$0.00</h2></div>
    </div>

    <div style="background: var(--camac-light); padding: 40px; border-radius: 8px; text-align: center; border: 1px dashed var(--camac-teal);">
        <h3 style="color: var(--camac-dark); margin-top: 0;">Market Trajectory Analysis</h3>
        <p style="color: #64748b; font-size: 14px; max-width: 600px; margin: 10px auto 25px auto;">Use the full-scale simulation engine to calculate complex price paths using Geometric Brownian Motion. Adjust volatility, drift, and time horizons to see institutional-grade forecasting.</p>
        
        <div class="view-toggle-bar" onclick="showFullScale()">
            <span>Enter Full-Scale Forecaster →</span>
        </div>
    </div>
</div>

<div id="fullScaleView">
    <div class="full-view-header">
        <div>
            <p class="brand-sub" style="margin:0;">Camac Consulting</p>
            <h2 style="margin:0; text-transform: uppercase; letter-spacing: 1px; color: var(--camac-dark);">Simulation Engine</h2>
        </div>
        <button class="exit-btn" onclick="showDashboard()">← Exit to Dashboard</button>
    </div>

    <div class="controls">
        <div>
            <label>Asset Ticker</label>
            <input type="text" id="symbol" placeholder="e.g. BTC">
            <p class="input-note">Identifier for charting and reporting.</p>
            
            <label style="margin-top: 15px;">Market Sentiment</label>
            <div class="preset-group">
                <button class="btn-preset" id="pessBtn" onclick="setPreset('pessimistic')">PESSIMISTIC</button>
                <button class="btn-preset active" id="neutBtn" onclick="setPreset('neutral')">NEUTRAL</button>
                <button class="btn-preset" id="optiBtn" onclick="setPreset('optimistic')">OPTIMISTIC</button>
            </div>
            <p class="input-note">Auto-fills Drift and Volatility expectations.</p>
        </div>
        <div>
            <label>Current Price ($)</label>
            <input type="number" id="manualPrice" placeholder="0.00" step="0.01">
            <p class="input-note">The starting valuation for the simulation.</p>
            
            <label style="margin-top: 15px;">Annual Drift (%)</label>
            <input type="number" id="drift" value="10.0">
            <p class="input-note">Expected annual rate of return (µ).</p>
            
            <label style="margin-top: 15px;">Annual Volatility (%)</label>
            <input type="number" id="volatility" value="20">
            <p class="input-note">Expected price variance / risk (σ).</p>
        </div>
        <div>
            <label>Time Horizon (Days)</label>
            <input type="number" id="days" value="30">
            <p class="input-note">Duration of the simulated path.</p>
            
            <label style="margin-top: 15px;">Price Target ($)</label>
            <input type="number" id="priceTarget">
            <p class="input-note">Calculates the probability of touching this price.</p>
            
            <label style="margin-top: 15px;">Simulations</label>
            <input type="number" id="sims" value="1000">
            <p class="input-note">Higher numbers (up to 100k) increase accuracy.</p>
        </div>
        <div class="btn-group">
            <button class="main-btn" style="background:var(--camac-dark); color:white;" onclick="runSimulation()">Run Engine</button>
            <button class="main-btn" style="background:var(--camac-teal); color:white;" onclick="downloadCSV()">Export Data</button>
            <button class="main-btn" style="background:var(--camac-teal); color:white;" onclick="saveChart()">Save Image</button>
            <button class="main-btn" style="background:#ddd;" onclick="location.reload()">Reset</button>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="fullChart"></canvas>
    </div>
</div>

<div class="footer-nav"><div class="footer-brand">Powered by CAMAC CONSULTING</div></div>

<script>
let chart;
let results = { p10:[], p50:[], p90:[], lastPrices:[], labels:[] };

const brandingPlugin = {
    id: 'branding',
    afterDraw: (chart) => {
        const ctx = chart.ctx;
        ctx.save();
        ctx.font = 'bold 12px Arial';
        ctx.fillStyle = 'rgba(0, 25, 53, 0.2)';
        ctx.textAlign = 'right';
        ctx.fillText('CAMAC CONSULTING', chart.width - 20, 25);
        ctx.restore();
    }
};
Chart.register(brandingPlugin);

function showFullScale() {
    document.getElementById('dashboardView').style.display = 'none';
    document.getElementById('fullScaleView').style.display = 'block';
}

function showDashboard() {
    document.getElementById('fullScaleView').style.display = 'none';
    document.getElementById('dashboardView').style.display = 'block';
}

function setPreset(type) {
    const d = document.getElementById('drift'), v = document.getElementById('volatility');
    document.querySelectorAll('.btn-preset').forEach(b => b.classList.remove('active'));
    if (type === 'pessimistic') { d.value = "-5.0"; v.value = "35"; document.getElementById('pessBtn').classList.add('active'); }
    else if (type === 'neutral') { d.value = "10.0"; v.value = "20"; document.getElementById('neutBtn').classList.add('active'); }
    else if (type === 'optimistic') { d.value = "20.0"; v.value = "15"; document.getElementById('optiBtn').classList.add('active'); }
}

function runSimulation() {
    const price = parseFloat(document.getElementById('manualPrice').value);
    const sims = parseInt(document.getElementById('sims').value) || 1000;
    const days = parseInt(document.getElementById('days').value) || 30;
    const drift = parseFloat(document.getElementById('drift').value)/100;
    const vol = parseFloat(document.getElementById('volatility').value)/100;
    const target = parseFloat(document.getElementById('priceTarget').value);

    if(!price) return alert("Enter starting price.");

    let paths = Array.from({length: days + 1}, () => new Float32Array(sims));
    const dt = 1/252;

    for(let s=0; s<sims; s++) {
        let p = price; paths[0][s] = p;
        for(let t=1; t<=days; t++) {
            let z = Math.sqrt(-2.0 * Math.log(Math.random()||0.001)) * Math.cos(2.0 * Math.PI * Math.random());
            p *= Math.exp((drift - 0.5 * vol**2)*dt + vol*Math.sqrt(dt)*z);
            paths[t][s] = p;
        }
    }

    results.labels = []; results.p10 = []; results.p50 = []; results.p90 = [];
    for(let t=0; t<=days; t++) {
        let sorted = paths[t].sort();
        results.labels.push(`Day ${t}`);
        results.p10.push(sorted[Math.floor(sims*0.1)]);
        results.p50.push(sorted[Math.floor(sims*0.5)]);
        results.p90.push(sorted[Math.floor(sims*0.9)]);
    }
    results.lastPrices = paths[days];

    // Update Dashboard & Full View Stats
    const finalMedian = results.p50[days];
    const finalUpper = results.p90[days];
    const prob = target ? (results.lastPrices.reduce((a,v)=>v>=target?a+1:a,0)/sims*100).toFixed(1) : "-";

    document.getElementById('dashPrice').innerText = `$${price.toFixed(2)}`;
    document.getElementById('dashMedian').innerText = `$${finalMedian.toFixed(2)}`;
    document.getElementById('dashUpper').innerText = `$${finalUpper.toFixed(2)}`;
    document.getElementById('dashProb').innerText = prob + (target ? "%" : "");

    if(chart) chart.destroy();
    chart = new Chart(document.getElementById('fullChart'), {
        type: 'line',
        data: {
            labels: results.labels,
            datasets: [
                { label: 'Median', data: results.p50, borderColor: '#001935', borderWidth: 3, pointRadius: 0 },
                { label: '90th Percentile', data: results.p90, borderColor: '#166534', borderWidth: 1, pointRadius: 0 },
                { label: '10th Percentile', data: results.p10, borderColor: '#991b1b', borderWidth: 1, pointRadius: 0 }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });
}

function downloadCSV() {
    let csv = "Day,P10,P50,P90\n";
    results.labels.forEach((l, i) => csv += `${l},${results.p10[i]},${results.p50[i]},${results.p90[i]}\n`);
    const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'})); a.download = 'sim_data.csv'; a.click();
}

function saveChart() {
    const a = document.createElement('a'); a.href = document.getElementById('fullChart').toDataURL(); a.download = 'forecast.png'; a.click();
}
</script>
</body>
</html>
