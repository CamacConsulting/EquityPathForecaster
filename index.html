<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equity Path Forecaster | Camac Consulting</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --camac-dark: #001935;
            --camac-teal: #41797e;
            --camac-light: #f4f7f9;
            --camac-accent: #64748b;
            --white: #ffffff;
            --pessimistic-red: #991b1b;
            --optimistic-green: #166534;
            --neutral-slate: #1e293b;
            --benchmark-gray: #94a3b8; 
        }

        body { font-family: "Segoe UI", Roboto, Arial, sans-serif; background: var(--white); padding: 15px; color: #333; margin: 0; }
        .container { max-width: 1100px; margin: auto; padding-bottom: 160px; } 
        
        .header-area { text-align: center; margin-bottom: 25px; border-bottom: 3px solid var(--camac-dark); padding-bottom: 20px; }
        .header-area h1 { font-size: 28px; color: var(--camac-dark); margin: 0; font-weight: 800; text-transform: uppercase; }
        .header-area .brand-sub { font-size: 12px; color: var(--camac-teal); font-weight: bold; text-transform: uppercase; margin-top: 5px; letter-spacing: 3px; }

        .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 15px; }
        .stat-card { background: var(--camac-teal); color: white; padding: 18px; border-radius: 4px; text-align: center; }
        .stat-card.dark { background: var(--camac-dark); }
        .stat-card h2 { margin: 5px 0 0 0; font-size: 24px; font-weight: 300; }
        .stat-card p { margin: 0; font-size: 10px; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }

        .summary-box { background: #fff; border: 1px solid #e2e8f0; border-left: 6px solid var(--camac-dark); padding: 25px; margin-bottom: 20px; border-radius: 4px; }
        .summary-box h3 { margin-top: 0; font-size: 14px; text-transform: uppercase; color: var(--camac-dark); border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .summary-content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 13px; line-height: 1.6; color: #334155; }

        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; background: var(--camac-light); padding: 25px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        label { font-weight: bold; font-size: 10px; color: var(--camac-dark); text-transform: uppercase; display: block; margin-bottom: 6px; }
        input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 14px; background: white; }
        .input-note { font-size: 9px; font-style: italic; color: #64748b; margin-top: 4px; line-height: 1.3; }

        .preset-group { display: flex; gap: 5px; margin-top: 5px; }
        .btn-preset { padding: 8px 4px; flex: 1; border: 1px solid #cbd5e1; border-radius: 3px; cursor: pointer; font-size: 9px; font-weight: bold; transition: 0.2s; }
        .btn-pess { background: #fee2e2; color: var(--pessimistic-red); }
        .btn-neut { background: #f1f5f9; color: var(--neutral-slate); }
        .btn-opti { background: #dcfce7; color: var(--optimistic-green); }
        .btn-preset.active { border: 2px solid var(--camac-dark); transform: scale(1.02); }

        .benchmark-toggle { display: flex; align-items: center; gap: 10px; margin-top: 15px; padding: 10px; background: #fff; border: 1px solid #cbd5e1; border-radius: 4px; }
        .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--camac-dark); }
        input:checked + .slider:before { transform: translateX(14px); }

        input.limit-exceeded { border-color: var(--pessimistic-red); background-color: #fff1f2; border-width: 2px; }
        #simWarning { display: none; color: var(--pessimistic-red); font-size: 9px; font-weight: bold; margin-top: 4px; text-transform: uppercase; }

        .btn-group { grid-column: 1 / -1; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 12px; margin-top: 10px; }
        button.main-btn { padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 11px; }

        .chart-container { height: 450px; margin-bottom: 30px; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; position: relative; }

        .table-wrapper { overflow-x: auto; border-radius: 8px; border: 1px solid #eee; background: #ffffff; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { background: var(--camac-dark); color: white; padding: 12px; text-align: center; text-transform: uppercase; font-size: 10px; }
        td { border-bottom: 1px solid #eee; padding: 12px; text-align: center; }

        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--camac-dark); padding: 20px 0; border-top: 4px solid var(--camac-teal); text-align: center; }
        .footer-brand { color: white; font-size: 11px; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <p class="brand-sub">Camac Consulting</p>
        <h1>Equity Path Forecaster</h1>
    </div>

    <div class="stats-bar">
        <div class="stat-card dark">
            <p>Entry Price</p>
            <h2 id="livePrice">$0.00</h2>
        </div>
        <div class="stat-card" id="probCard">
            <p>Prob. of Target</p>
            <h2 id="probDisplay">-%</h2>
        </div>
        <div class="stat-card">
            <p>Median Forecast</p>
            <h2 id="medianDisplay">$0.00</h2>
        </div>
        <div class="stat-card">
            <p>90th Percentile</p>
            <h2 id="targetDisplay">$0.00</h2>
        </div>
    </div>

    <div id="insightSummary" class="summary-box">
        <h3>Executive Summary</h3>
        <div class="summary-content" id="summaryTarget">
            <p>Waiting for simulation data... Generate a forecast to view the thorough analysis.</p>
        </div>
    </div>

    <div class="controls">
        <div>
            <label>Asset Name / Ticker</label>
            <input type="text" id="symbol" placeholder="e.g. BTC">
            <p class="input-note">The name of the equity or asset being analyzed.</p>
            
            <label style="margin-top: 15px;">Market Sentiment</label>
            <div class="preset-group">
                <button id="btn-pess" class="btn-preset btn-pess" onclick="setPreset('pessimistic', this)">PESSIMISTIC</button>
                <button id="btn-neut" class="btn-preset btn-neut active" onclick="setPreset('neutral', this)">NEUTRAL</button>
                <button id="btn-opti" class="btn-preset btn-opti" onclick="setPreset('optimistic', this)">OPTIMISTIC</button>
            </div>
            <p class="input-note">Automatically aligns Drift and Volatility.</p>

            <div class="benchmark-toggle">
                <label class="switch">
                    <input type="checkbox" id="benchmarkSwitch" onchange="toggleBenchmarkLine()">
                    <span class="slider"></span>
                </label>
                <span style="font-size: 10px; font-weight: bold; color: var(--camac-dark);">S&P 500 BENCHMARK MODE</span>
            </div>
            <p class="input-note">Overlay the S&P 500 as a neutral baseline.</p>
        </div>

        <div>
            <label>Current Price ($)</label>
            <input type="number" id="manualPrice" placeholder="0.00" step="0.01">
            <p class="input-note">The starting market price for the simulation.</p>
            
            <label style="margin-top: 15px;">Annual Drift (%)</label>
            <input type="number" id="drift" value="10.0">
            <p class="input-note">Annualized growth rate before volatility drag.</p>
            
            <label style="margin-top: 15px;">Annual Volatility (%)</label>
            <input type="number" id="volatility" value="20">
            <p class="input-note">Fear factor: S&P (15%), Tech (35%), Crypto (70%+).</p>
        </div>

        <div>
            <label>Time Horizon (Days)</label>
            <input type="number" id="days" value="30">
            <p class="input-note">Total trading days for forecast.</p>
            
            <label style="margin-top: 15px;">Price Target ($)</label>
            <input type="number" id="priceTarget" placeholder="Enter target..." oninput="calculateProbability()">
            <p class="input-note">Desired price to calculate probability of success.</p>
            
            <label style="margin-top: 15px;">Simulations (Max 100k)</label>
            <input type="number" id="sims" value="1000" min="1" max="100000" oninput="validateSimCount(this)" onblur="enforceSimLimit(this)">
            <div id="simWarning">âš  MAX LIMIT IS 100,000</div>
            <p class="input-note">Precision cap: 100,000.</p>
        </div>
        
        <div class="btn-group">
            <button id="runBtn" class="main-btn" style="background:var(--camac-dark); color:white;" onclick="analyzeAndRun()">Generate Forecast</button>
            <button class="main-btn" style="background:var(--camac-teal); color:white;" onclick="downloadCSV()">Export CSV</button>
            <button class="main-btn" style="background:var(--camac-accent); color:white;" onclick="saveChartImage()">Save PNG</button>
            <button class="main-btn" style="background:#e2e8f0; color:#475569;" onclick="location.reload()">Reset</button>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="mainChart"></canvas>
    </div>

    <div class="table-wrapper">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Time Interval</th>
                    <th>Pessimistic (10th)</th>
                    <th>Neutral (50th)</th>
                    <th>Optimistic (90th)</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr><td colspan="4" style="color:#94a3b8; padding:40px;">No data generated yet.</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div class="footer-nav">
    <div class="footer-brand">Powered by CAMAC CONSULTING</div>
</div>

<script>
let chart;
let currentResults = { allPaths: [], p10: [], p50: [], p90: [], benchmark: [], labels: [] };

function setPreset(type, element) {
    const driftInput = document.getElementById('drift');
    const volInput = document.getElementById('volatility');
    document.querySelectorAll('.btn-preset').forEach(b => b.classList.remove('active'));
    if(element) element.classList.add('active');
    if (type === 'pessimistic') { driftInput.value = "-5.0"; volInput.value = "45"; }
    else if (type === 'neutral') { driftInput.value = "10.0"; volInput.value = "20"; }
    else if (type === 'optimistic') { driftInput.value = "20.0"; volInput.value = "15"; }
}

function validateSimCount(input) {
    const warning = document.getElementById('simWarning');
    if (parseInt(input.value) > 100000) {
        input.classList.add('limit-exceeded');
        warning.style.display = 'block';
    } else {
        input.classList.remove('limit-exceeded');
        warning.style.display = 'none';
    }
}

function enforceSimLimit(input) {
    if (parseInt(input.value) > 100000) { input.value = 100000; validateSimCount(input); }
}

function toggleBenchmarkLine() {
    if (!chart) return;
    const isChecked = document.getElementById('benchmarkSwitch').checked;
    chart.data.datasets[1].data = isChecked ? currentResults.benchmark : [];
    chart.update();
}

function analyzeAndRun() {
    const price = parseFloat(document.getElementById('manualPrice').value);
    const ticker = (document.getElementById('symbol').value || "Asset").toUpperCase();
    const sims = Math.min(100000, parseInt(document.getElementById('sims').value) || 1000);
    const days = parseInt(document.getElementById('days').value) || 30;
    const isBenchmark = document.getElementById('benchmarkSwitch').checked;

    if (isNaN(price)) return alert("Please enter a starting price.");
    document.getElementById('livePrice').innerText = `$${price.toFixed(2)}`;

    const dt = 1/252;
    const drift = (parseFloat(document.getElementById('drift').value) || 0) / 100;
    const vol = (parseFloat(document.getElementById('volatility').value) || 0) / 100;

    let paths = Array.from({length: days + 1}, () => new Float32Array(sims));
    let bPath = [price]; 

    for (let s = 0; s < sims; s++) {
        let p = price;
        paths[0][s] = p;
        for (let t = 1; t <= days; t++) {
            let u = Math.random(), v = Math.random();
            let z = Math.sqrt(-2.0 * Math.log(u || 0.0001)) * Math.cos(2.0 * Math.PI * v);
            p *= Math.exp((drift - 0.5 * vol**2) * dt + vol * Math.sqrt(dt) * z);
            paths[t][s] = p;
        }
    }

    // Benchmark calculation (12% Drift, 15% Vol)
    for (let t = 1; t <= days; t++) {
        bPath.push(bPath[t-1] * Math.exp((0.12 - 0.5 * 0.15**2) * dt));
    }

    updateUI(paths, bPath, ticker, days, sims, isBenchmark);
}

function updateUI(results, bPath, ticker, days, sims, isBenchmark) {
    let labels = [], p10 = [], p50 = [], p90 = [], tableHtml = "";
    for (let t = 0; t <= days; t++) {
        results[t].sort();
        labels.push(`Day ${t}`);
        let v10 = results[t][Math.floor(sims * 0.1)];
        let v50 = results[t][Math.floor(sims * 0.5)];
        let v90 = results[t][Math.floor(sims * 0.9)];
        p10.push(v10); p50.push(v50); p90.push(v90);
        if (t % 5 === 0 || t === days) {
            tableHtml += `<tr><td>Day ${t}</td><td>$${v10.toFixed(2)}</td><td>$${v50.toFixed(2)}</td><td>$${v90.toFixed(2)}</td></tr>`;
        }
    }

    currentResults = { allPaths: results[days], p10, p50, p90, benchmark: bPath, labels };
    document.getElementById('tableBody').innerHTML = tableHtml;
    document.getElementById('medianDisplay').innerText = `$${p50[days].toFixed(2)}`;
    document.getElementById('targetDisplay').innerText = `$${p90[days].toFixed(2)}`;

    const startP = results[0][0], endP = p50[days], changePct = (((endP - startP) / startP) * 100).toFixed(2);
    const mktPerf = (((bPath[days] - bPath[0]) / bPath[0]) * 100).toFixed(2);
    const alpha = (changePct - mktPerf).toFixed(2);

    document.getElementById('summaryTarget').innerHTML = `
        <div class="summary-item">
            <strong>Directional Bias:</strong> Trajectory for ${ticker} is <strong>${changePct > 0 ? 'Bullish' : 'Bearish'}</strong>, with a median projection of <strong>$${endP.toFixed(2)}</strong> (${changePct}%).
            <br><br>
            <strong>Statistical Range:</strong> 80% probability that price settles between <strong>$${p10[days].toFixed(2)}</strong> and <strong>$${p90[days].toFixed(2)}</strong>.
        </div>
        <div class="summary-item">
            <strong>Benchmark Analysis:</strong> Compared to S&P 500 baseline (${mktPerf}%), asset is projected to <strong>${alpha > 0 ? 'outperform' : 'underperform'}</strong> market by <strong>${Math.abs(alpha)}%</strong>.
            <br><br>
            <strong>Risk Profile:</strong> Volatility of ${document.getElementById('volatility').value}% creates a price spread of <strong>$${(p90[days] - p10[days]).toFixed(2)}</strong>.
        </div>
    `;

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('mainChart'), {
        type: 'line',
        data: {
            labels,
            datasets: [
                { label: 'Neutral Median', data: p50, borderColor: '#1e293b', borderWidth: 4, pointRadius: 0 },
                { label: 'S&P 500 (Neutral Baseline)', data: isBenchmark ? bPath : [], borderColor: '#94a3b8', borderDash: [6, 4], borderWidth: 2, pointRadius: 0 },
                { label: 'Optimistic (90th)', data: p90, borderColor: '#166534', borderWidth: 1, pointRadius: 0 },
                { label: 'Pessimistic (10th)', data: p10, borderColor: '#991b1b', borderWidth: 1, pointRadius: 0 }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
    });
    calculateProbability();
}

function calculateProbability() {
    const target = parseFloat(document.getElementById('priceTarget').value);
    if (isNaN(target) || !currentResults.allPaths.length) return;
    const prob = (currentResults.allPaths.reduce((acc, p) => p >= target ? acc + 1 : acc, 0) / currentResults.allPaths.length) * 100;
    document.getElementById('probDisplay').innerText = prob.toFixed(1) + "%";
}

function downloadCSV() {
    if (!currentResults.labels.length) return alert("Generate forecast first.");
    let csv = "Day,Pessimistic,Neutral,Optimistic\n";
    currentResults.labels.forEach((l, i) => { csv += `${l},${currentResults.p10[i]},${currentResults.p50[i]},${currentResults.p90[i]}\n`; });
    const blob = new Blob([csv], { type: 'text/csv' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Forecaster_Data.csv`; a.click();
}

function saveChartImage() {
    if (!chart) return alert("Generate forecast first.");
    const tempCanvas = document.createElement('canvas');
    const ctx = tempCanvas.getContext('2d');
    const sourceCanvas = document.getElementById('mainChart');
    tempCanvas.width = sourceCanvas.width; tempCanvas.height = sourceCanvas.height;
    ctx.fillStyle = "#FFFFFF"; ctx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
    ctx.drawImage(sourceCanvas, 0, 0);
    const a = document.createElement('a'); a.href = tempCanvas.toDataURL('image/png'); a.download = `Market_Forecast.png`; a.click();
}
</script>
</body>
</html>
