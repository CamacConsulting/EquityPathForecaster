<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equity Path Forecaster | Camac Consulting</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --camac-dark: #001935;
            --camac-teal: #41797e;
            --camac-light: #f4f7f9;
            --camac-accent: #64748b;
            --white: #ffffff;
            --pessimistic-red: #991b1b;
            --optimistic-green: #166534;
            --neutral-slate: #1e293b;
        }

        body { font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--white); padding: 15px; color: #333; margin: 0; }
        .container { max-width: 1000px; margin: auto; padding-bottom: 160px; } 
        
        .header-area { text-align: center; margin-bottom: 25px; border-bottom: 3px solid var(--camac-dark); padding-bottom: 20px; }
        .header-area h1 { font-size: 28px; color: var(--camac-dark); margin: 0; font-weight: 800; text-transform: uppercase; letter-spacing: -0.5px; }
        .header-area .brand-sub { font-size: 12px; color: var(--camac-teal); font-weight: bold; text-transform: uppercase; margin-top: 5px; letter-spacing: 3px; }

        .stats-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .stat-card { background: var(--camac-teal); color: white; padding: 18px; border-radius: 4px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-card.dark { background: var(--camac-dark); }
        .stat-card h2 { margin: 5px 0 0 0; font-size: 26px; font-weight: 300; }
        .stat-card p { margin: 0; font-size: 10px; text-transform: uppercase; font-weight: bold; opacity: 0.9; letter-spacing: 1px; }

        .summary-box { background: #fff; border: 1px solid #e2e8f0; border-left: 5px solid var(--camac-teal); padding: 20px; margin-bottom: 20px; border-radius: 4px; font-size: 13px; line-height: 1.6; color: #475569; }

        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            background: var(--camac-accent);
            color: white;
            border-radius: 50%;
            font-size: 10px;
            font-weight: bold;
            cursor: help;
            margin-left: 5px;
            position: relative;
            vertical-align: middle;
        }
        .info-icon:hover::after {
            content: "Confidence is calculated as a function of volatility and time. Higher market turbulence or longer durations decrease forecast certainty.";
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--camac-dark);
            color: white;
            padding: 10px;
            border-radius: 4px;
            width: 220px;
            font-size: 11px;
            font-weight: normal;
            line-height: 1.4;
            z-index: 100;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; background: var(--camac-light); padding: 25px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        label { font-weight: bold; font-size: 10px; color: var(--camac-dark); text-transform: uppercase; display: block; margin-bottom: 6px; }
        input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; box-sizing: border-box; font-size: 14px; background: white; }
        .input-note { font-size: 9px; font-style: italic; color: #64748b; margin-top: 4px; line-height: 1.3; }

        .preset-group { display: flex; gap: 5px; margin-top: 5px; }
        .btn-preset { padding: 8px 4px; flex: 1; border: 1px solid #cbd5e1; border-radius: 3px; cursor: pointer; font-size: 9px; font-weight: bold; transition: 0.2s; }
        .btn-pess { background: #fee2e2; color: var(--pessimistic-red); }
        .btn-neut { background: #f1f5f9; color: var(--neutral-slate); }
        .btn-opti { background: #dcfce7; color: var(--optimistic-green); }
        .btn-preset.active { border: 2px solid var(--camac-dark); transform: scale(1.02); }

        .btn-group { grid-column: 1 / -1; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 12px; margin-top: 10px; }
        button.main-btn { padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; letter-spacing: 1.5px; font-size: 11px; }
        #runBtn { background: var(--camac-dark); color: white; }
        #resetBtn { background: #e2e8f0; color: #475569; }
        #exportBtn { background: var(--camac-teal); color: white; }
        #saveImgBtn { background: var(--camac-accent); color: white; }

        .chart-container { height: 450px; margin-bottom: 30px; position: relative; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; }
        #loader { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; text-align: center; background: rgba(255,255,255,0.95); padding: 30px; border-radius: 8px; }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--camac-light); border-top: 4px solid var(--camac-teal); border-radius: 50%; animation: spin 1s linear infinite; margin: auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .table-wrapper { position: relative; overflow-x: auto; border-radius: 8px; border: 1px solid #eee; background: #ffffff; }
        .table-wrapper::after { content: "CAMAC CONSULTING"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); font-size: 40px; font-weight: 900; color: rgba(65, 121, 126, 0.05); pointer-events: none; }

        table { width: 100%; border-collapse: collapse; font-size: 12px; table-layout: fixed; }
        th { background: var(--camac-dark); color: white; padding: 12px 5px; text-align: center; text-transform: uppercase; font-size: 10px; }
        td { border-bottom: 1px solid #eee; padding: 12px 5px; text-align: center; }

        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--camac-dark); padding: 20px 0; border-top: 4px solid var(--camac-teal); text-align: center; z-index: 1000; }
        .footer-content { display: flex; justify-content: center; align-items: center; gap: 40px; max-width: 1000px; margin: auto; }
        .footer-brand { color: white; font-size: 11px; text-transform: uppercase; letter-spacing: 2px; font-weight: bold; }
        .footer-nav a { color: #ffffff; background-color: var(--camac-teal); font-weight: bold; text-decoration: none; font-size: 11px; padding: 8px 20px; border-radius: 4px; }
        
        @media (max-width: 768px) { 
            .controls { grid-template-columns: 1fr; } 
            .stats-bar { grid-template-columns: 1fr; } 
            .btn-group { grid-template-columns: 1fr; } 
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <p class="brand-sub">Camac Consulting</p>
        <h1>Equity Path Forecaster</h1>
    </div>

    <div class="stats-bar">
        <div class="stat-card dark">
            <p>Entry Price</p>
            <h2 id="livePrice">---</h2>
        </div>
        <div class="stat-card" id="probCard">
            <p id="probLabel">Prob. of Success</p>
            <h2 id="probDisplay">SET TARGET</h2>
        </div>
        <div class="stat-card">
            <p>Optimistic (90th)</p>
            <h2 id="targetDisplay">---</h2>
        </div>
    </div>

    <div id="insightSummary" class="summary-box">
        <strong>Status:</strong> Analysis pending. Input your asset parameters below to generate a detailed market outlook.
    </div>

    <div class="controls">
        <div>
            <label>Asset Name / Ticker</label>
            <input type="text" id="symbol" placeholder="e.g. AAPL">
            <p class="input-note">The name of the equity or asset being analyzed.</p>
            
            <label style="margin-top: 15px;">Market Sentiment</label>
            <div class="preset-group">
                <button id="btn-pess" class="btn-preset btn-pess" onclick="setPreset('pessimistic', this)">PESSIMISTIC</button>
                <button id="btn-neut" class="btn-preset btn-neut" onclick="setPreset('neutral', this)">NEUTRAL</button>
                <button id="btn-opti" class="btn-preset btn-opti" onclick="setPreset('optimistic', this)">OPTIMISTIC</button>
            </div>
            <p class="input-note">Automatically aligns Drift and Volatility to specific market regimes.</p>
        </div>

        <div>
            <label>Current Price ($)</label>
            <input type="number" id="manualPrice" placeholder="0.00" step="0.01">
            <p class="input-note">The starting market price for the simulation.</p>
            
            <label style="margin-top: 15px;">Expected Drift (Annual %)</label>
            <input type="number" id="drift" value="10.0" step="0.1" oninput="updateDriftContext()">
            <p class="input-note">Annualized growth rate before volatility drag.</p>
            
            <label style="margin-top: 15px;">Annual Volatility (%)</label>
            <input type="number" id="volatility" value="20" step="1" oninput="updateDriftContext()">
            <p class="input-note">Fear factor: S&P (15%), Tech (35%), Crypto (70%+).</p>
            
            <div id="driftContext" style="margin-top: 8px; padding: 8px; background: #fff; border-left: 3px solid var(--camac-teal); font-size: 9px;">
                <strong>Status:</strong> Neutral Baseline. | <strong>Risk:</strong> <span id="riskLevel">Low</span>
            </div>
        </div>

        <div>
            <label>Time Horizon (Days)</label>
            <input type="number" id="days" value="30">
            <p class="input-note">Total trading days to forecast into the future.</p>
            
            <label style="margin-top: 15px;">Price Target ($)</label>
            <input type="number" id="priceTarget" placeholder="Enter Goal Price..." oninput="calculateProbability()">
            <p class="input-note">Desired price to calculate probability of success.</p>
            
            <label style="margin-top: 15px;">Simulations</label>
            <input type="number" id="sims" value="1000">
            <p class="input-note">Higher counts increase statistical accuracy.</p>
        </div>
        
        <div class="btn-group">
            <button id="runBtn" class="main-btn" onclick="analyzeAndRun()">Generate Forecast</button>
            <button id="resetBtn" class="main-btn" onclick="resetForm()">Reset</button>
            <button id="exportBtn" class="main-btn" onclick="downloadCSV()">Export CSV</button>
            <button id="saveImgBtn" class="main-btn" onclick="saveChartImage()">Save PNG</button>
        </div>
    </div>

    <div class="chart-container">
        <div id="loader"><div class="spinner"></div><p style="font-size:10px; margin-top:10px;">CALCULATING...</p></div>
        <canvas id="mainChart"></canvas>
    </div>

    <div class="table-wrapper">
        <table id="dataTable">
            <thead>
                <tr><th>Time Interval</th><th>Pessimistic (10th)</th><th>Neutral (50th)</th><th>Optimistic (90th)</th></tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="footer-nav">
    <div class="footer-content">
        <div class="footer-brand">Powered by CAMAC CONSULTING</div>
        <a href="javascript:void(0);" onclick="window.open(window.location.href, '_blank');">Expand Workspace</a>
    </div>
</div>

<script>
let chart;
let currentResults = { allPaths: [], p10: [], p50: [], p90: [], labels: [], startPrice: 0 };

function setPreset(type, element) {
    const driftInput = document.getElementById('drift');
    const volInput = document.getElementById('volatility');
    document.querySelectorAll('.btn-preset').forEach(b => b.classList.remove('active'));
    if(element) element.classList.add('active');

    if (type === 'pessimistic') {
        driftInput.value = "-5.0";
        volInput.value = "45";
    } else if (type === 'neutral') {
        driftInput.value = "10.0";
        volInput.value = "20";
    } else if (type === 'optimistic') {
        driftInput.value = "20.0";
        volInput.value = "15";
    }
    updateDriftContext();
}

function updateDriftContext() {
    const drift = parseFloat(document.getElementById('drift').value) || 0;
    const vol = parseFloat(document.getElementById('volatility').value) || 0;
    const contextBox = document.getElementById('driftContext');
    
    let driftText = drift <= 0 ? "Pessimistic (Bear)" : (drift <= 12 ? "Neutral (Baseline)" : "Optimistic (Bull)");
    let riskText = "Low";
    let riskColor = "#166534";

    if (vol > 60) { riskText = "Extreme (Crypto)"; riskColor = "#7f1d1d"; }
    else if (vol > 35) { riskText = "High (Tech)"; riskColor = "#991b1b"; }
    else if (vol > 20) { riskText = "Moderate (Equity)"; riskColor = "#b45309"; }

    contextBox.innerHTML = `<strong>Status:</strong> ${driftText} | <strong>Risk:</strong> <span id="riskLevel" style="color:${riskColor}; font-weight:bold;">${riskText}</span>`;
}

function analyzeAndRun() {
    const manualPrice = parseFloat(document.getElementById('manualPrice').value);
    const symbol = document.getElementById('symbol').value;
    if (!symbol || isNaN(manualPrice)) return alert("Please enter Asset Name and Price.");
    
    document.getElementById('loader').style.display = 'block';
    document.getElementById('livePrice').innerText = `$${manualPrice.toFixed(2)}`;
    
    setTimeout(() => {
        const days = Math.max(1, parseInt(document.getElementById('days').value) || 30);
        const sims = Math.max(1, Math.min(parseInt(document.getElementById('sims').value) || 1000, 20000));
        const annualDrift = (parseFloat(document.getElementById('drift').value) || 0) / 100;
        const annualVol = (parseFloat(document.getElementById('volatility').value) || 0) / 100;

        const dt = 1 / 252;
        const muDaily = (annualDrift - 0.5 * Math.pow(annualVol, 2)) * dt;
        const sigmaDaily = annualVol * Math.sqrt(dt);

        let results = Array.from({length: days + 1}, () => []);
        for (let s = 0; s < sims; s++) {
            let p = manualPrice;
            results[0].push(p);
            for (let t = 1; t <= days; t++) {
                let u = Math.random(), v = Math.random();
                let z = Math.sqrt(-2.0 * Math.log(u || 0.0001)) * Math.cos(2.0 * Math.PI * v);
                p *= Math.exp(muDaily + (sigmaDaily * z));
                results[t].push(p);
            }
        }
        updateUI(results, days, sims);
        document.getElementById('loader').style.display = 'none';
    }, 100);
}

function updateUI(results, days, sims) {
    let labels = [], p10 = [], p50 = [], p90 = [], rows = "";
    const i10 = Math.floor(sims * 0.1), i50 = Math.floor(sims * 0.5), i90 = Math.floor(sims * 0.9);

    for (let t = 0; t <= days; t++) {
        results[t].sort((a,b) => a-b);
        labels.push(`Day ${t}`);
        const v10 = results[t][i10], v50 = results[t][i50], v90 = results[t][i90];
        p10.push(v10); p50.push(v50); p90.push(v90);
        if (t % 5 === 0 || t === days) {
            rows += `<tr><td>Day ${t}</td><td>$${v10.toFixed(2)}</td><td>$${v50.toFixed(2)}</td><td>$${v90.toFixed(2)}</td></tr>`;
        }
    }
    currentResults = { allPaths: results[days], p10, p50, p90, labels, startPrice: results[0][0] };
    document.getElementById('targetDisplay').innerText = `$${p90[days].toFixed(2)}`;
    document.querySelector("#dataTable tbody").innerHTML = rows;
    
    const symbol = (document.getElementById('symbol').value || "Asset").toUpperCase();
    const startP = results[0][0];
    const medP = p50[days];
    const highP = p90[days];
    const lowP = p10[days];
    const volVal = parseFloat(document.getElementById('volatility').value) || 0;
    
    const changePct = (((medP - startP) / startP) * 100).toFixed(1);
    const rangePct = (((highP - lowP) / startP) * 100).toFixed(1);
    
    let confidenceScore = Math.max(15, 100 - (volVal * 0.8) - (days * 0.15));
    let outlook = changePct > 0 ? "bullish" : "bearish";

    document.getElementById('insightSummary').innerHTML = `
        <strong style="color:var(--camac-dark)">EXECUTIVE SUMMARY: ${symbol}</strong><br>
        Based on a simulation of ${sims.toLocaleString()} outcomes, the asset shows a <strong>${outlook} bias</strong> over the next <strong>${days} days</strong>. 
        The median price target is projected at <strong>$${medP.toFixed(2)}</strong>, representing a <strong>${changePct}%</strong> move. 
        The model anticipates a price spread of <strong>${rangePct}%</strong> between the extreme percentiles. 
        <br><br>
        <span style="background:var(--camac-dark); color:white; padding: 2px 8px; border-radius:3px; font-size:11px; font-weight:bold;">
            CONFIDENCE LEVEL: ${confidenceScore.toFixed(0)}%
        </span>
        <span class="info-icon">i</span>
        <span style="font-size:11px; font-style:italic; margin-left:10px;">
            (Score adjusted for ${volVal}% volatility and ${days}-day duration)
        </span>
    `;
    
    calculateProbability();

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('mainChart').getContext('2d'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'Optimistic (90th)', data: p90, borderColor: '#166534', borderWidth: 2, pointRadius: 0, tension: 0.1 },
                { label: 'Neutral (Median)', data: p50, borderColor: '#1e293b', borderWidth: 4, pointRadius: 0, tension: 0.1 },
                { label: 'Pessimistic (10th)', data: p10, borderColor: '#991b1b', borderWidth: 2, pointRadius: 0, tension: 0.1 }
            ]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: false, 
            interaction: { mode: 'index', intersect: false },
            plugins: { 
                legend: { position: 'bottom' },
                tooltip: {
                    backgroundColor: 'rgba(0, 25, 53, 0.9)',
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                        }
                    }
                }
            },
            scales: { 
                y: { ticks: { callback: v => '$' + v } },
                x: { ticks: { maxRotation: 0, autoSkip: true, maxTicksLimit: 10 } }
            }
        }
    });
}

function calculateProbability() {
    const target = parseFloat(document.getElementById('priceTarget').value);
    if (isNaN(target) || !currentResults.allPaths.length) return;
    const successes = currentResults.allPaths.filter(p => p >= target).length;
    const prob = (successes / currentResults.allPaths.length) * 100;
    document.getElementById('probDisplay').innerText = prob.toFixed(1) + "%";
    document.getElementById('probCard').style.background = prob < 30 ? "#991b1b" : (prob > 70 ? "#166534" : "#41797e");
}

function resetForm() { location.reload(); }

function downloadCSV() {
    if (!currentResults.labels.length) return alert("Generate forecast first.");
    const symbol = (document.getElementById('symbol').value || "Asset").toUpperCase();
    let csv = "Day,Pessimistic,Neutral,Optimistic\n";
    currentResults.labels.forEach((l, i) => { csv += `${l},${currentResults.p10[i]},${currentResults.p50[i]},${currentResults.p90[i]}\n`; });
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a'); 
    a.setAttribute('href', url); 
    a.setAttribute('download', `${symbol}_Forecast.csv`); 
    a.click();
}

function saveChartImage() {
    if (!chart) return alert("Generate forecast first.");
    const symbol = (document.getElementById('symbol').value || "Asset").toUpperCase();
    const a = document.createElement('a'); 
    a.href = chart.toBase64Image(); 
    a.download = `${symbol}_Chart.png`; 
    a.click();
}

window.onload = () => { setPreset('neutral', document.getElementById('btn-neut')); };
</script>
</body>
</html>
