<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equity Path Forecaster | Camac Consulting</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --camac-dark: #001935;
            --camac-teal: #41797e;
            --camac-light: #f4f7f9;
            --camac-accent: #64748b;
            --white: #ffffff;
            --pessimistic-red: #991b1b;
            --optimistic-green: #166534;
            --neutral-slate: #1e293b;
            --benchmark-gold: #b45309;
        }

        body { font-family: "Segoe UI", Roboto, Arial, sans-serif; background: var(--white); padding: 15px; color: #333; margin: 0; }
        .container { max-width: 1000px; margin: auto; padding-bottom: 160px; } 
        
        .header-area { text-align: center; margin-bottom: 25px; border-bottom: 3px solid var(--camac-dark); padding-bottom: 20px; }
        .header-area h1 { font-size: 28px; color: var(--camac-dark); margin: 0; font-weight: 800; text-transform: uppercase; }
        .header-area .brand-sub { font-size: 12px; color: var(--camac-teal); font-weight: bold; text-transform: uppercase; margin-top: 5px; letter-spacing: 3px; }

        .stats-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .stat-card { background: var(--camac-teal); color: white; padding: 18px; border-radius: 4px; text-align: center; }
        .stat-card.dark { background: var(--camac-dark); }
        .stat-card h2 { margin: 5px 0 0 0; font-size: 26px; font-weight: 300; }
        .stat-card p { margin: 0; font-size: 10px; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }

        .summary-box { background: #fff; border: 1px solid #e2e8f0; border-left: 5px solid var(--camac-teal); padding: 20px; margin-bottom: 20px; border-radius: 4px; font-size: 13px; line-height: 1.6; color: #475569; }

        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; background: var(--camac-light); padding: 25px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        label { font-weight: bold; font-size: 10px; color: var(--camac-dark); text-transform: uppercase; display: block; margin-bottom: 6px; }
        input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 14px; background: white; transition: border-color 0.2s; }
        .input-note { font-size: 9px; font-style: italic; color: #64748b; margin-top: 4px; }

        /* Benchmark Toggle */
        .benchmark-toggle { display: flex; align-items: center; gap: 10px; margin-top: 15px; padding: 10px; background: #fff; border: 1px solid #cbd5e1; border-radius: 4px; }
        .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--benchmark-gold); }
        input:checked + .slider:before { transform: translateX(14px); }

        /* Warning UI */
        input.limit-exceeded { border-color: var(--pessimistic-red); border-width: 2px; background-color: #fff1f2; }
        #simWarning { display: none; color: var(--pessimistic-red); font-size: 9px; font-weight: bold; margin-top: 4px; }

        .btn-group { grid-column: 1 / -1; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 12px; margin-top: 10px; }
        button.main-btn { padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; font-size: 11px; }
        #runBtn { background: var(--camac-dark); color: white; }
        #resetBtn { background: #e2e8f0; color: #475569; }

        .chart-container { height: 450px; margin-bottom: 30px; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; position: relative; }
        #loader { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; text-align: center; }

        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--camac-dark); padding: 20px 0; border-top: 4px solid var(--camac-teal); text-align: center; z-index: 1000; }
        .footer-brand { color: white; font-size: 11px; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <p class="brand-sub">Camac Consulting</p>
        <h1>Equity Path Forecaster</h1>
    </div>

    <div class="stats-bar">
        <div class="stat-card dark">
            <p>Entry Price</p>
            <h2 id="livePrice">---</h2>
        </div>
        <div class="stat-card" id="probCard">
            <p id="probLabel">Prob. of Success</p>
            <h2 id="probDisplay">SET TARGET</h2>
        </div>
        <div class="stat-card">
            <p>90th Percentile</p>
            <h2 id="targetDisplay">---</h2>
        </div>
    </div>

    <div id="insightSummary" class="summary-box">
        <strong>Status:</strong> Ready for input. Compare your asset against the S&P 500 benchmark.
    </div>

    <div class="controls">
        <div>
            <label>Asset Name / Ticker</label>
            <input type="text" id="symbol" placeholder="e.g. NVDA">
            
            <div class="benchmark-toggle">
                <label class="switch">
                    <input type="checkbox" id="benchmarkSwitch">
                    <span class="slider"></span>
                </label>
                <span style="font-size: 10px; font-weight: bold; color: var(--benchmark-gold);">S&P 500 BENCHMARK MODE</span>
            </div>
            <p class="input-note">Overlay the S&P 500 (12% Growth / 15% Vol) as a market baseline.</p>
        </div>

        <div>
            <label>Current Price ($)</label>
            <input type="number" id="manualPrice" placeholder="0.00" step="0.01">
            
            <label style="margin-top: 15px;">Expected Drift (Annual %)</label>
            <input type="number" id="drift" value="10.0" step="0.1">
            
            <label style="margin-top: 15px;">Annual Volatility (%)</label>
            <input type="number" id="volatility" value="20" step="1">
        </div>

        <div>
            <label>Time Horizon (Days)</label>
            <input type="number" id="days" value="30">
            
            <label style="margin-top: 15px;">Price Target ($)</label>
            <input type="number" id="priceTarget" placeholder="Target price..." oninput="calculateProbability()">
            
            <label style="margin-top: 15px;">Simulations (Max 100k)</label>
            <input type="number" id="sims" value="1000" min="1" max="100000" oninput="validateSimCount(this)" onblur="enforceSimLimit(this)">
            <div id="simWarning">âš  MAX LIMIT IS 100,000</div>
        </div>
        
        <div class="btn-group">
            <button id="runBtn" class="main-btn" onclick="analyzeAndRun()">Generate Forecast</button>
            <button id="resetBtn" class="main-btn" onclick="resetForm()">Reset</button>
            <button class="main-btn" style="background:var(--camac-teal); color:white;" onclick="downloadCSV()">CSV</button>
            <button class="main-btn" style="background:var(--camac-accent); color:white;" onclick="saveChartImage()">PNG</button>
        </div>
    </div>

    <div class="chart-container">
        <div id="loader"><p>PROCESSING...</p></div>
        <canvas id="mainChart"></canvas>
    </div>
</div>

<div class="footer-nav">
    <div class="footer-brand">Powered by CAMAC CONSULTING</div>
</div>

<script>
let chart;
let currentResults = { allPaths: [], p10: [], p50: [], p90: [], benchmark: [], labels: [], startPrice: 0 };

function validateSimCount(input) {
    const warning = document.getElementById('simWarning');
    if (parseInt(input.value) > 100000) {
        input.classList.add('limit-exceeded');
        warning.style.display = 'block';
    } else {
        input.classList.remove('limit-exceeded');
        warning.style.display = 'none';
    }
}

function enforceSimLimit(input) {
    if (parseInt(input.value) > 100000) { input.value = 100000; validateSimCount(input); }
}

function analyzeAndRun() {
    const price = parseFloat(document.getElementById('manualPrice').value);
    const sims = Math.min(100000, parseInt(document.getElementById('sims').value) || 1000);
    const days = parseInt(document.getElementById('days').value) || 30;
    const isBenchmark = document.getElementById('benchmarkSwitch').checked;

    if (isNaN(price)) return alert("Enter price.");
    document.getElementById('livePrice').innerText = `$${price.toFixed(2)}`;

    // Calc Logic
    const dt = 1/252;
    const drift = (parseFloat(document.getElementById('drift').value) || 0) / 100;
    const vol = (parseFloat(document.getElementById('volatility').value) || 0) / 100;
    
    // Benchmark Baseline (S&P 500 2026 Estimate)
    const bDrift = 0.12; 
    const bVol = 0.15;

    let paths = Array.from({length: days + 1}, () => new Float32Array(sims));
    let bPath = [price]; // Simplified median benchmark path

    for (let s = 0; s < sims; s++) {
        let p = price;
        paths[0][s] = p;
        for (let t = 1; t <= days; t++) {
            let z = Math.sqrt(-2 * Math.log(Math.random() || 0.001)) * Math.cos(2 * Math.PI * Math.random());
            p *= Math.exp((drift - 0.5 * vol**2) * dt + vol * Math.sqrt(dt) * z);
            paths[t][s] = p;
        }
    }

    // Generate Benchmark Median Curve
    for (let t = 1; t <= days; t++) {
        bPath.push(bPath[t-1] * Math.exp((bDrift - 0.5 * bVol**2) * dt));
    }

    updateUI(paths, bPath, days, sims, isBenchmark);
}

function updateUI(results, bPath, days, sims, isBenchmark) {
    let labels = [], p10 = [], p50 = [], p90 = [];
    for (let t = 0; t <= days; t++) {
        results[t].sort();
        labels.push(`Day ${t}`);
        p10.push(results[t][Math.floor(sims * 0.1)]);
        p50.push(results[t][Math.floor(sims * 0.5)]);
        p90.push(results[t][Math.floor(sims * 0.9)]);
    }

    currentResults = { allPaths: results[days], p10, p50, p90, benchmark: bPath, labels };
    document.getElementById('targetDisplay').innerText = `$${p90[days].toFixed(2)}`;
    
    const assetPerf = (((p50[days] - p50[0]) / p50[0]) * 100).toFixed(1);
    const mktPerf = (((bPath[days] - bPath[0]) / bPath[0]) * 100).toFixed(1);
    const alpha = (assetPerf - mktPerf).toFixed(1);

    document.getElementById('insightSummary').innerHTML = `
        <strong>ANALYSIS:</strong> Asset projected to move <strong>${assetPerf}%</strong>. 
        ${isBenchmark ? `<br><strong>ALPHA:</strong> This ${alpha > 0 ? 'outperforms' : 'underperforms'} the S&P 500 benchmark (${mktPerf}%) by <strong>${Math.abs(alpha)}%</strong>.` : ''}
    `;

    if (chart) chart.destroy();
    chart = new Chart(document.getElementById('mainChart'), {
        type: 'line',
        data: {
            labels,
            datasets: [
                { label: 'Neutral (Median)', data: p50, borderColor: '#1e293b', borderWidth: 4, pointRadius: 0 },
                { label: 'Market Benchmark (S&P)', data: isBenchmark ? bPath : [], borderColor: '#b45309', borderDash: [5, 5], borderWidth: 2, pointRadius: 0 },
                { label: '90th Percentile', data: p90, borderColor: '#166534', borderWidth: 1, pointRadius: 0 },
                { label: '10th Percentile', data: p10, borderColor: '#991b1b', borderWidth: 1, pointRadius: 0 }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });
    calculateProbability();
}

function calculateProbability() {
    const target = parseFloat(document.getElementById('priceTarget').value);
    if (isNaN(target) || !currentResults.allPaths.length) return;
    const prob = (currentResults.allPaths.reduce((acc, p) => p >= target ? acc + 1 : acc, 0) / currentResults.allPaths.length) * 100;
    document.getElementById('probDisplay').innerText = prob.toFixed(1) + "%";
}

function resetForm() { location.reload(); }
function downloadCSV() { /* same as previous */ }
function saveChartImage() { /* same as previous */ }
</script>
</body>
</html>
