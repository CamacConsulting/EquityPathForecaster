<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equity Path Forecaster | Camac Consulting</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --camac-dark: #001935;
            --camac-teal: #41797e;
            --camac-light: #f4f7f9;
            --camac-accent: #64748b;
            --white: #ffffff;
            --pessimistic-red: #991b1b;
            --optimistic-green: #166534;
        }

        body { font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--white); padding: 15px; color: #333; margin: 0; }
        .container { max-width: 1000px; margin: auto; padding-bottom: 120px; } 
        
        .header-area { text-align: center; margin-bottom: 25px; border-bottom: 3px solid var(--camac-dark); padding-bottom: 20px; }
        .header-area h1 { font-size: 28px; color: var(--camac-dark); margin: 0; font-weight: 800; text-transform: uppercase; letter-spacing: -0.5px; }
        .header-area .brand-sub { font-size: 12px; color: var(--camac-teal); font-weight: bold; text-transform: uppercase; margin-top: 5px; letter-spacing: 3px; }

        .stats-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--camac-teal); color: white; padding: 18px; border-radius: 4px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-card.dark { background: var(--camac-dark); }
        .stat-card h2 { margin: 5px 0 0 0; font-size: 26px; font-weight: 300; }
        .stat-card p { margin: 0; font-size: 10px; text-transform: uppercase; font-weight: bold; opacity: 0.9; letter-spacing: 1px; }

        .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; background: var(--camac-light); padding: 25px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        label { font-weight: bold; font-size: 10px; color: var(--camac-dark); text-transform: uppercase; display: block; margin-bottom: 6px; }
        
        .currency-wrapper { position: relative; display: flex; align-items: center; }
        .currency-wrapper span { position: absolute; left: 10px; font-size: 14px; color: var(--camac-accent); font-weight: bold; }
        .currency-wrapper input { padding-left: 22px !important; }

        input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; box-sizing: border-box; font-size: 14px; background: white; }
        
        .input-hint { font-size: 9px; font-style: italic; color: #64748b; line-height: 1.3; margin-top: 5px; display: block; }

        .preset-group { display: flex; gap: 5px; margin-top: 5px; }
        .btn-preset { padding: 8px 6px; flex: 1; border: 2px solid transparent; border-radius: 4px; cursor: pointer; font-size: 9px; font-weight: 800; transition: 0.2s; outline: none; }
        
        .btn-pessimistic { background: #fee2e2; color: var(--pessimistic-red); border-color: #fecaca; }
        .btn-neutral { background: #f1f5f9; color: #1e293b; border-color: #e2e8f0; }
        .btn-optimistic { background: #dcfce7; color: var(--optimistic-green); border-color: #bbf7d0; }

        /* ACTIVE STATE: Thick dark border to indicate selection */
        .btn-preset.active { border-color: var(--camac-dark); box-shadow: 0 0 0 1px var(--camac-dark); transform: scale(1.02); }

        .btn-group { grid-column: 1 / -1; display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 12px; margin-top: 10px; }
        button.main-btn { padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; letter-spacing: 1.5px; transition: 0.3s; font-size: 11px; }
        #runBtn { background: var(--camac-dark); color: white; }
        #resetBtn { background: #e2e8f0; color: #475569; }
        #exportBtn { background: var(--camac-teal); color: white; }
        #probBtn { background: var(--camac-accent); color: white; }

        .chart-container { height: 420px; margin-bottom: 30px; position: relative; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; }
        #loader { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; text-align: center; background: rgba(255,255,255,0.95); padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--camac-light); border-top: 4px solid var(--camac-teal); border-radius: 50%; animation: spin 1s linear infinite; margin: auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .table-wrapper { overflow-x: auto; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { background: var(--camac-dark); color: white; padding: 12px; text-align: left; text-transform: uppercase; letter-spacing: 1px; font-size: 10px; }
        td { border-bottom: 1px solid #eee; padding: 12px; }
        
        .footer-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--camac-dark); padding: 15px 0; border-top: 4px solid var(--camac-teal); text-align: center; z-index: 1000; }
        .footer-nav a { color: #ffffff; background-color: var(--camac-teal); font-weight: bold; text-decoration: none; font-size: 12px; padding: 10px 25px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <p class="brand-sub">Camac Consulting</p>
        <h1>Equity Path Forecaster</h1>
    </div>

    <div class="stats-bar">
        <div class="stat-card dark">
            <p id="tickerLabel">Market Price</p>
            <h2 id="livePrice">---</h2>
        </div>
        <div class="stat-card">
            <p id="probLabel">Prob. of Success</p>
            <h2 id="probDisplay">SET TARGET</h2>
        </div>
        <div class="stat-card">
            <p>90th Percentile Goal</p>
            <h2 id="targetDisplay">---</h2>
        </div>
    </div>

    <div class="controls">
        <div>
            <label>Asset Ticker</label>
            <input type="text" id="symbol" value="NVDA">
            <label style="margin-top:12px;">Select Market Sentiment</label>
            <div class="preset-group">
                <button id="btn-pess" class="btn-preset btn-pessimistic" onclick="setPreset('pessimistic', this)">PESSIMISTIC</button>
                <button id="btn-neut" class="btn-preset btn-neutral" onclick="setPreset('neutral', this)">NEUTRAL</button>
                <button id="btn-opti" class="btn-preset btn-optimistic" onclick="setPreset('optimistic', this)">OPTIMISTIC</button>
            </div>
        </div>
        <div>
            <label>Price Override ($)</label>
            <div class="currency-wrapper">
                <span>$</span>
                <input type="number" id="manualPrice" placeholder="Use custom price..." step="0.01">
            </div>
            <span class="input-hint">Leave blank to use live market data.</span>
        </div>
        <div>
            <label>Time Horizon (Days)</label>
            <input type="number" id="days" value="30">
        </div>
        <div>
            <label>Simulations (Max 50k)</label>
            <input type="number" id="sims" value="1000">
        </div>
        <div>
            <label>Expected Drift (Annual %)</label>
            <input type="number" id="drift" value="10.0" step="0.1" oninput="updateDriftContext()">
            <div id="driftContext" class="input-hint" style="margin-top: 8px; padding: 8px; background: #fff; border-left: 3px solid var(--camac-teal); font-style: normal; font-size: 9px; min-height: 35px; color: #333;">
                Adjust drift to change sentiment...
            </div>
        </div>
        <div>
            <label>Price Target ($)</label>
            <div class="currency-wrapper">
                <span>$</span>
                <input type="number" id="priceTarget" placeholder="Target Price..." oninput="calculateProbability()">
            </div>
            <span class="input-hint">Probability of achieving this price point.</span>
        </div>
        
        <div class="btn-group">
            <button id="runBtn" class="main-btn" onclick="analyzeAndRun()">Generate Forecast</button>
            <button id="resetBtn" class="main-btn" onclick="resetForm()">Reset</button>
            <button id="exportBtn" class="main-btn" onclick="downloadCSV()">Export CSV</button>
            <button id="probBtn" class="main-btn" onclick="calculateProbability()">Update Goal</button>
        </div>
    </div>

    <div class="chart-container">
        <div id="loader">
            <div class="spinner"></div>
            <p style="font-size:10px; margin-top:15px; font-weight:bold; color: var(--camac-dark);">CALCULATING MONTE CARLO PATHS...</p>
        </div>
        <canvas id="mainChart"></canvas>
    </div>

    <div class="table-wrapper">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Time Interval</th>
                    <th>Pessimistic (10th P)</th>
                    <th>Median (50th P)</th>
                    <th>Optimistic (90th P)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="footer-nav">
    <a href="javascript:void(0);" onclick="window.open(window.location.href, '_blank');">EXPAND WORKSPACE</a>
</div>

<script>
let chart;
let currentResults = { allPaths: [], p10: [], p50: [], p90: [], labels: [] };
const apiKey = '6PQ2Z7ZB4JQDZ3LS';

function setPreset(type, element) {
    const driftInput = document.getElementById('drift');
    
    // UI: Update Active State
    document.querySelectorAll('.btn-preset').forEach(btn => btn.classList.remove('active'));
    if (element) element.classList.add('active');

    // Values
    if (type === 'pessimistic') driftInput.value = "-5.0";
    else if (type === 'neutral') driftInput.value = "10.0"; 
    else if (type === 'optimistic') driftInput.value = "20.0";
    
    updateDriftContext();
}

function updateDriftContext() {
    const drift = parseFloat(document.getElementById('drift').value);
    const contextBox = document.getElementById('driftContext');
    let text = "";
    
    // Optional: Clear active borders if user manually types a drift not matching presets
    if (drift !== -5.0 && drift !== 10.0 && drift !== 20.0) {
        document.querySelectorAll('.btn-preset').forEach(btn => btn.classList.remove('active'));
    }

    if (isNaN(drift)) return;
    if (drift <= 0) text = "<strong>Pessimistic:</strong> Expecting market corrections or defensive conditions.";
    else if (drift <= 11) text = "<strong>Neutral:</strong> Aligned with historical ~10% equity market growth.";
    else text = "<strong>Optimistic:</strong> Projecting strong sector momentum or market expansion.";
    
    contextBox.innerHTML = `<strong>Sentiment:</strong> ${text}`;
}

async function analyzeAndRun() {
    const symbol = document.getElementById('symbol').
